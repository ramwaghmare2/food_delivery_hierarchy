{% extends 'admin/admin_base.html' %}

{% block content %}
<div class="container-fluid">
    <h1 class="h3 mb-4 text-gray-800">Order List</h1>

    <!-- Search Form -->
    <form method="GET" action="{{ url_for('orders.order_list') }}">
        <input type="text" name="search" placeholder="Search..." value="{{ request.args.get('search', '') }}">
        
        <select name="filter_by">
            <option value="all" {% if request.args.get('filter_by') == 'all' %}selected{% endif %}>All</option>
            <option value="user_id" {% if request.args.get('filter_by') == 'user_id' %}selected{% endif %}>User ID</option>
            <option value="order_id" {% if request.args.get('filter_by') == 'order_id' %}selected{% endif %}>Order ID</option>
            <option value="kitchen_id" {% if request.args.get('filter_by') == 'kitchen_id' %}selected{% endif %}>Kitchen ID</option>
        </select>
    
        <select name="status">
            <option value="" {% if not request.args.get('status') %}selected{% endif %}>Any Status</option>
            <option value="pending" {% if request.args.get('status') == 'pending' %}selected{% endif %}>Pending</option>
            <option value="processing" {% if request.args.get('status') == 'processing' %}selected{% endif %}>Processing</option>
            <option value="cancelled" {% if request.args.get('status') == 'cancelled' %}selected{% endif %}>Cancelled</option>
            <option value="completed" {% if request.args.get('status') == 'completed' %}selected{% endif %}>Completed</option>
        </select>
    
        <button type="submit">Filter</button>
    </form>    
    
    
    <!-- Orders Table -->
    {% if exception_message %}
    <div class="alert alert-warning">
        {{ exception_message }}
    </div>
    {% endif %}

    {% if orders %}
    <table class="table table-striped table-bordered" id="ordersTable">
        <thead>
            <tr>
                <th>Order ID</th>
                <th>User ID</th>
                <th>Total Amount</th>
                <th>Order Status</th>
                <th>Created At</th>
                <th>Updated At</th>
                <th>Kitchen ID</th>
            </tr>
        </thead>
        <tbody>
            {% for order in orders.items %}
            <tr>
                <td>{{ order.order_id }}</td>
                <td>{{ order.user_id }}</td>
                <td>â‚¹{{ order.total_amount }}</td>
                <td>{{ order.order_status }}</td>
                <td>{{ order.created_at }}</td>
                <td>{{ order.updated_at }}</td>
                <td>{{ order.kitchen_id }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% else %}
    <p>No orders to display.</p>
{% endif %}
    <!-- Pagination -->
    <div class="pagination">
        {% if orders.has_prev %}
        <a href="{{ url_for('orders.order_list', page=orders.prev_num, search=request.args.get('search', ''), filter_by=request.args.get('filter_by', 'all'), status=request.args.get('status', '')) }}">Previous</a>
        {% endif %}
        {% if orders.has_next %}
        <a href="{{ url_for('orders.order_list', page=orders.next_num, search=request.args.get('search', ''), filter_by=request.args.get('filter_by', 'all'), status=request.args.get('status', '')) }}">Next</a>
        {% endif %}
    </div>
</div>

<!-- JavaScript for Search functionality -->
<script>
    document.getElementById("searchBtn").addEventListener("click", function(event) {
        event.preventDefault(); // Prevents the form from submitting normally
        var searchQuery = document.getElementById("searchInput").value;

        // Filter rows based on search query
        var rows = document.querySelectorAll("#ordersTable tbody tr");
        rows.forEach(function(row) {
            var orderId = row.cells[0].textContent.toLowerCase();
            var customerName = row.cells[1].textContent.toLowerCase();

            if (orderId.includes(searchQuery.toLowerCase()) || customerName.includes(searchQuery.toLowerCase())) {
                row.style.display = ""; // Show row
            } else {
                row.style.display = "none"; // Hide row
            }
        });
    });
</script>

<!-- Optional: Responsive Design CSS -->
<style>
    /* Basic table styling */
    table {
        width: 100%;
        margin-bottom: 1rem;
        border-collapse: collapse;
    }
    
    th, td {
        padding: 12px;
        text-align: left;
    }

    th {
        background-color: #f4f4f4;
    }

    tbody tr:hover {
        background-color: #f1f1f1;
    }

    /* Pagination styling */
    .pagination {
        display: flex;
        justify-content: center;
        margin-top: 20px;
    }

    .pagination a {
        padding: 10px;
        margin: 0 5px;
        background-color: #007bff;
        color: white;
        text-decoration: none;
        border-radius: 5px;
    }

    .pagination a:hover {
        background-color: #0056b3;
    }

    /* Make the table responsive */
    @media (max-width: 768px) {
        table {
            font-size: 12px;
        }

        .pagination a {
            padding: 8px;
            font-size: 12px;
        }
    }
</style>

{% endblock %}
