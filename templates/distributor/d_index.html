{% include 'd_header.html' %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
    .chart-container {
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.chart-container canvas {
    width: 300px;
    height: 400px;
    border: 1px solid rgb(126, 120, 120); /* Border */
    border-radius: 5px; /* Optional: Adds rounded corners */
    padding: 10px; /* Optional: Adds spacing inside the border */
}

.chart-wrapper {
    flex: 1;
    margin: 10px;
}


    .card {
        transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card:hover {
        transform: translateY(-10px);
        box-shadow: 0 10px 15px rgba(0, 0, 0, 0.2);
    }

    @keyframes bounceIn {
    0% {
        transform: translateY(1000px);
        opacity: 0;
    }
    60% {
        transform: translateY(-30px);
        opacity: 1;
    }
    80% {
        transform: translateY(10px);
    }
    100% {
        transform: translateY(0);
    }
}

.chart-container canvas {
    animation: bounceIn 1s ease-out;
}


</style>

<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <h1 class="mt-4">Distributor</h1>
            <ol class="breadcrumb mb-4">
                <li class="breadcrumb-item active">Dashboard</li>
            </ol>
            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="card bg-success text-white fixed-card mb-4">
                        <div class="card-body"><b>Kitchens</b></div>
                        <div class="card-footer d-flex align-items-center justify-content-between">
                            <h4 class="mb-0">{{ kitchen_count }}</h4>
                            <div class="small text-white"><i class="fas fa-utensils"></i></div>
                            <a class="small text-white stretched-link" href="{{ url_for('distributor.distrubutor_all_kitchens') }}">View Details</a>
                            <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                        </div>
                    </div>
                </div>
                <!-- Total Orders -->
                <div class="col-lg-3 col-md-6">
                    <div class="card bg-secondary text-white fixed-card mb-4">
                        <div class="card-body"><b>Total Orders</b></div>
                        <div class="card-footer d-flex align-items-center justify-content-between">
                            <h4 class="mb-0">{{ order_count }}</h4>
                            <div class="small text-white"><i class="fas fa-box"></i></div>
                            <a class="small text-white stretched-link" href="{{ url_for('distributor.distributor_orders') }}">View Details</a>
                            <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="card bg-primary text-white fixed-card mb-4">
                        <div class="card-body"><b>Total Sales</b></div>
                        <div class="card-footer d-flex align-items-center justify-content-between">
                            <h4 class="mb-0">â‚¹{{ total_price }}</h4>
                            <div class="small text-white"><i class=""></i></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-wrapper">
                    <canvas id="barChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
            <script>
                const kitchenNames = {{ kitchen_names | safe }};
                const orderCounts = {{ order_counts | safe }};
                const salesData = {{ sales_data | safe }};
                const barWidth = kitchenNames.length > 5 ? 0.5 : 0.6;

                // Bar Chart
                const barCtx = document.getElementById('barChart').getContext('2d');
new Chart(barCtx, {
    type: 'bar',
    data: {
        labels: kitchenNames,
        datasets: [{
            label: 'Number of Orders',
            data: orderCounts,
            backgroundColor: 'rgba(135, 206, 250, 0.6)', // Skyblue
            borderColor: 'rgba(135, 206, 250, 1)',
            borderWidth: 1,
            borderSkipped: false,  // Prevent border from skipping corners
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: true },
            title: { display: true, text: 'Kitchen Orders Count' }
        },
        scales: {
            x: {
                title: { display: true, text: 'Kitchens' },
                ticks: {
                    maxRotation: 90,
                    minRotation: 45
                },
                barPercentage: 0.8,  // Adjusted bar width to make it visually appealing
                categoryPercentage: 0.8
            },
            y: { title: { display: true, text: 'Number of Orders' }, beginAtZero: true }
        },
        animation: {
            duration: 1500, // Set the duration of the animation
            easing: 'easeOutBounce', // Add an ease effect to make the animation smoother
            onProgress: function(animation) {
                // This function will run during the animation progress
                console.log(`Animation Progress: ${Math.round(animation.progress)}%`);
            },
            onComplete: function() {
                // This function will run when the animation is complete
                console.log('Animation Complete!');
            }
        },
        hover: {
            mode: 'nearest',
            intersect: true,
            onHover: function(event, chartElement) {
                if (chartElement.length > 0) {
                    // Highlight the bar when hovered
                    const datasetIndex = chartElement[0].datasetIndex;
                    const index = chartElement[0].index;
                    barChart.data.datasets[datasetIndex].backgroundColor[index] = 'rgba(0, 191, 255, 1)'; // Change color on hover
                    barChart.update();
                }
            },
            onLeave: function(event, chartElement) {
                // Reset the color when the hover leaves
                if (chartElement.length > 0) {
                    const datasetIndex = chartElement[0].datasetIndex;
                    const index = chartElement[0].index;
                    barChart.data.datasets[datasetIndex].backgroundColor[index] = 'rgba(135, 206, 250, 0.6)'; // Reset color
                    barChart.update();
                }
            }
        }
    }
});


// Pie Chart with Zoom Effect on Hover for Individual Segments
const pieCtx = document.getElementById('pieChart').getContext('2d');
const pieChart = new Chart(pieCtx, {
    type: 'pie',
    data: {
        labels: kitchenNames,
        datasets: [{
            label: 'Total Sales',
            data: salesData,
            backgroundColor: [
                'rgba(255, 99, 132, 0.6)',   // Pink
                'rgba(54, 162, 235, 0.6)',   // Blue
                'rgba(255, 206, 86, 0.6)',   // Yellow
                'rgba(75, 192, 192, 0.6)',   // Green
                'rgba(153, 102, 255, 0.6)',  // Purple
                'rgba(255, 159, 64, 0.6)'    // Orange
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { 
                display: true, 
                position: 'top' 
            },
            title: { display: true, text: 'Total Sales by Kitchen' }
        },
        animation: {
            onProgress: function () {
                pieChart.update();
            },
            onComplete: function () {
                pieChart.update();
            }
        },
        hover: {
            mode: 'nearest',
            intersect: true,
            onHover: function(event, chartElement) {
                // Reset scale for all segments
                pieChart.data.datasets[0].backgroundColor = [
                    'rgba(255, 99, 132, 0.6)',   // Pink
                    'rgba(54, 162, 235, 0.6)',   // Blue
                    'rgba(255, 206, 86, 0.6)',   // Yellow
                    'rgba(75, 192, 192, 0.6)',   // Green
                    'rgba(153, 102, 255, 0.6)',  // Purple
                    'rgba(255, 159, 64, 0.6)'    // Orange
                ];

                // Check if a segment is hovered
                if (chartElement.length) {
                    const segmentIndex = chartElement[0].index;

                    // Apply zoom effect on hover: scale up the hovered segment
                    const dataSetMeta = pieChart.getDatasetMeta(0);
                    const segment = dataSetMeta.data[segmentIndex];
                    segment.scale = 1.5;  // Zoom in by 50% or more (change this value for more/less zoom)

                    // Update color for the hovered segment
                    pieChart.data.datasets[0].backgroundColor[segmentIndex] = 'rgba(54, 162, 235, 1)'; // Blue for hover

                    pieChart.update();
                }
            },
            onLeave: function(event, chartElement) {
                // Reset zoom effect when the cursor leaves the segment
                if (chartElement.length) {
                    const segmentIndex = chartElement[0].index;
                    const dataSetMeta = pieChart.getDatasetMeta(0);
                    const segment = dataSetMeta.data[segmentIndex];
                    segment.scale = 1; // Reset to normal scale
                    pieChart.data.datasets[0].backgroundColor[segmentIndex] = 'rgba(255, 99, 132, 0.6)'; // Reset color
                    pieChart.update();
                }
            }
        }
    }
});

            </script>
        </div>
    </main>
{% include 'd_footer.html' %}
