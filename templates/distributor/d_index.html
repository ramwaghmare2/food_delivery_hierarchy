{% include 'd_header.html' %}

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
 


</style>

<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <h1 class="mt-4">Distributor</h1>
            <ol class="breadcrumb mb-4">
                <li class="breadcrumb-item active">Dashboard</li>
            </ol>
            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="card bg-success text-white fixed-card mb-4">
                        <div class="card-body"><b>Kitchens</b></div>
                        <div class="card-footer d-flex align-items-center justify-content-between">
                            <h4 class="mb-0">{{ kitchen_count }}</h4>
                            <div class="small text-white"><i class="fas fa-utensils"></i></div>
                            <a class="small text-white stretched-link" href="{{ url_for('distributor.distrubutor_all_kitchens') }}">View Details</a>
                            <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                        </div>
                    </div>
                </div>
                <!-- Total Orders -->
                <div class="col-lg-3 col-md-6">
                    <div class="card bg-secondary text-white fixed-card mb-4">
                        <div class="card-body"><b>Total Orders</b></div>
                        <div class="card-footer d-flex align-items-center justify-content-between">
                            <h4 class="mb-0">{{ order_count }}</h4>
                            <div class="small text-white"><i class="fas fa-shopping-cart"></i></div>
                            <a class="small text-white stretched-link" href="{{ url_for('distributor.distributor_orders') }}">View Details</a>
                            <div class="small text-white"><i class="fas fa-angle-right"></i></div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-3 col-md-6">
                    <div class="card bg-primary text-white fixed-card mb-4">
                        <div class="card-body"><b>Total Sales</b></div>
                        <div class="card-footer d-flex align-items-center justify-content-between">
                            <h4 class="mb-0">₹{{ total_price }}</h4>
                            <div class="small text-white"><i class=""></i></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <ol class="breadcrumb mt-2 mb-2">
                <li class="breadcrumb-item active">Sales Data</li>
            </ol>
            <!-- Totals Table -->
    <div class="card shadow mb-4 mt-4" style="background-color: #3e3e3e;">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Summary</h6>
        </div>
        <div class="card-body">
            <table class="table table-bordered table-hover text-white">
                <thead>
                    <tr class="thead-light">
                        <th>Total Sales (₹)</th>
                        <th>Quantity Sold</th>
                        <th>Total Orders</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>

                        <td>₹ {{ total_price }}</td>
                        <td>{{ total_quantity_sold}}</td>
                        <td>{{ order_count }}</td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>

    <label for="filter" class="form-label">Filter By:</label>
            <form method="GET" href="{{ url_for('distributor.distributor_home') }}" style="width:300px;display: flex; align-items: center;">
                
                <select name="filter" id="filter" class="form-select">
                    <option value="all" {% if filter_type == 'all' %}selected{% endif %}>All</option>
                    <option value="today" {% if filter_type == 'today' %}selected{% endif %}>Today</option>
                    <option value="yesterday" {% if filter_type == 'yesterday' %}selected{% endif %}>Yesterday</option>
                    <option value="monthly" {% if filter_type == 'monthly' %}selected{% endif %}>Monthly</option>
                    <option value="yearly" {% if filter_type == 'yearly' %}selected{% endif %}>Yearly</option>
                </select>
                <button type="submit" class="btn btn-primary" style="margin-left: 10px;">Apply</button>
            </form>

    <!-- Sales Data Table -->
    <div class="card shadow mt-4" style="background-color: #3e3e3e;">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Sales Data Table</h6>
        </div>
        <div class="table-container">
            <div class="table-responsive">
                <table class="table table-hover table-bordered text-white">
                    <thead class="thead-light">
                        <tr>
                            <th>Sale ID</th>
                            <th>Item Name</th>
                            <th>Price (₹)</th>
                            <th>Quantity</th>
                            <th>Sale Date</th>
                            <th>Order id</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if total_sales_data %}
                            {% for sale_id, datetime, item_name, price, quantity,order_id in total_sales_data %}
                            <tr>
                                <td>{{ sale_id }}</td>
                                <td>{{ item_name }}</td>
                                <td>₹ {{ price }}</td>
                                <td>{{ quantity }}</td>
                                <td>{{ datetime.strftime('%Y-%m-%d %H:%M:%S') if datetime else 'N/A' }}</td>
                                <td>{{order_id}}</td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <tr>
                                <td colspan="5" class="text-center">No sales data available</td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    
    <ol class="breadcrumb mt-5 mb-2">
        <li class="breadcrumb-item active">Statistics</li>
    </ol>
            <div class="chart-container mt-2 mb-4">
                <div class="chart-wrapper">
                    <canvas id="barChart"></canvas>
                </div>
                <div class="chart-wrapper">
                    <canvas id="pieChart"></canvas>
                </div>
            </div>
            <script>
                const kitchenNames = {{ kitchen_names | safe }};
                const orderCounts = {{ order_counts | safe }};
                const salesData = {{ sales_data | safe }};
                const barWidth = kitchenNames.length > 5 ? 0.5 : 0.6;

// Bar Chart
const barCtx = document.getElementById('barChart').getContext('2d');
const barChart = new Chart(barCtx, {
    type: 'bar',
    data: {
        labels: kitchenNames,
        datasets: [{
            label: 'Number of Orders',
            data: orderCounts,
            backgroundColor: 'rgba(135, 206, 250, 0.6)', // Skyblue
            borderColor: 'rgba(135, 206, 250, 1)',
            borderWidth: 1,
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { display: true },
            title: { display: true, text: 'Kitchen Orders Count' }
        },
        scales: {
            x: {
                title: { display: true, text: 'Kitchens' },
                ticks: { maxRotation: 90, minRotation: 45 },
                barPercentage: 0.8,
                categoryPercentage: 0.8
            },
            y: {
                title: { display: true, text: 'Number of Orders' },
                beginAtZero: true
            }
        },
        animation: {
            duration: 1500,
            easing: 'easeOutBounce',
        },
        hover: {
            mode: 'nearest',
            intersect: true,
            onHover: function(event, chartElement) {
                if (chartElement.length > 0) {
                    const index = chartElement[0].index;
                    barChart.data.datasets[0].backgroundColor[index] = 'rgba(0, 191, 255, 1)'; // Highlight color
                    barChart.update('none');
                }
            },
            onLeave: function(event, chartElement) {
                if (chartElement.length > 0) {
                    const index = chartElement[0].index;
                    barChart.data.datasets[0].backgroundColor[index] = 'rgba(135, 206, 250, 0.6)'; // Reset color
                    barChart.update('none');
                }
            }
        }
    }
});

// Pie Chart
const pieLabels = {{ pie_chart_labels | safe }};
const pieData = {{ pie_chart_data | safe }};

const pieCtx = document.getElementById('pieChart').getContext('2d');
const pieChart = new Chart(pieCtx, {
    type: 'pie',
    data: {
        labels: pieLabels,
        datasets: [{
            label: 'Kitchens Sale ',
            data: pieData,
            backgroundColor: [
                'rgba(255, 99, 132, 0.6)',   // Pink
                'rgba(54, 162, 235, 0.6)',   // Blue
                'rgba(255, 206, 86, 0.6)',   // Yellow
                'rgba(75, 192, 192, 0.6)',   // Green
                'rgba(153, 102, 255, 0.6)',  // Purple
                'rgba(255, 159, 64, 0.6)'    // Orange
            ],
            hoverBackgroundColor: [
                'rgba(255, 99, 132, 0.8)',   // Brighter Pink
                'rgba(54, 162, 235, 0.8)',   // Brighter Blue
                'rgba(255, 206, 86, 0.8)',   // Brighter Yellow
                'rgba(75, 192, 192, 0.8)',   // Brighter Green
                'rgba(153, 102, 255, 0.8)',  // Brighter Purple
                'rgba(255, 159, 64, 0.8)'    // Brighter Orange
            ],
            borderWidth: 1,
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: { 
                display: true, 
                position: 'top' 
            },
            title: { 
                display: true, 
                text: 'Total Sales Count by Kitchen' 
            }
        },
        animation: {
            duration: 1500,
            easing: 'easeOutCubic',
        },
        hover: {
            mode: 'nearest',
            intersect: true,
        }
    }
});
            </script>
        </div>

        <style>
            .table-bordered th, .table-bordered td {
                border: 1px solid #ffffff !important;
            }
        
            .table-hover tbody tr:hover {
                background-color: #eef154 !important;
            }
        
            .table-responsive {
                margin-top: 15px;
            }
        
            .card {
                border-radius: 10px;
            }
        
            .card-header {
                background-color: #eef154;
                color: #fff;
            }
        
            .table-container {
            max-height: 300px; /* Adjust as needed to show approximately 10 rows */
            overflow-y: auto;
            position: relative;
        }
        
        .sales-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .sales-table th, .sales-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        /* Make the header sticky */
        .sales-table th {
            background-color: #f4f4f4; /* Header color */
            position: sticky;
            top: 0;
            z-index: 2; /* Higher than tbody rows to stay above */
        }
        
        /* Optional: Style for the table rows */
        .sales-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }
        
        .sales-table tr:hover {
            background-color: #f1f1f1;
        }
        
        </style>    
    </main>
{% include 'd_footer.html' %}
