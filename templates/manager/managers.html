{% if role == 'Admin' %}
    {% include 'admin/admin_header.html' %}
{% else %}
    {% include 'super_distributor/sd_header.html' %}
{% endif %}

<div id="layoutSidenav_content">
    <main>
        <div class="container-fluid px-4">
            <h2 class="text-center">Managers List</h2>

            <!-- Display flash messages for success or error -->
            {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                {% endfor %}
            {% endif %}
            {% endwith %}

            <!-- Filters -->
            <div class="mb-4">
                <form method="GET" action="{{ url_for('manager.get_managers') }}">
                    <label for="filter">Filter by Status:</label>
                    <select name="status" id="filter" class="form-select" onchange="this.form.submit()">
                        <option value="all" {% if filter == 'all' %}selected{% endif %}>All</option>
                        <option value="activated" {% if filter == 'activated' %}selected{% endif %}>Activated</option>
                        <option value="deactivated" {% if filter == 'deactivated' %}selected{% endif %}>Deactivated</option>
                    </select>
                </form>
            </div>

            <!-- Display Total Managers and Activated Managers Count -->
            <p><b>Total Managers: {{ managers|length }}</b></p>

            <!-- Manager Cards -->
            <div class="row">
                {% for manager in managers %}
                {% if filter == 'all' or manager.status == filter %}
                    <div class="col-md-4 mb-4"> <!-- Added margin-bottom for spacing between cards -->
                        <div class="card manager-card">
                            <div class="card-body manager-card-body">
                                <!-- Manager Image -->
                                {% if manager.image_base64 %}
                                <img src="{{ manager.image_base64 }}" alt="Manager Image" class="manager-image" width="120" height="120">
                                {% else %}
                                No Image
                                {% endif %}
                                <div class="status-dot mt-2">
                                    {% if manager.online_status %}
                                        <span class="green-dot"></span> Online
                                    {% else %}
                                        <span class="red-dot"></span> Offline
                                    {% endif %}
                                </div>

                                <!-- Manager Info -->
                                <div class="manager-info mt-3">
                                    <h5 class="card-title">{{ manager.name }}</h5>
                                    <p class="card-text"><strong>Email:</strong> {{ manager.email }}</p>
                                    <p class="card-text"><strong>Contact:</strong> {{ manager.contact }}</p>
                                    <p class="card-text">
                                        <strong>Status:</strong> 
                                        <span class="badge 
                                            {% if manager.status == 'activated' %}
                                                bg-success
                                            {% else %}
                                                bg-secondary
                                            {% endif %}">
                                            {{ manager.status | capitalize }}
                                        </span>
                                    </p>

                                    <!-- Action Buttons -->
                                    <div class="action-buttons">
                                        <a href="{{ url_for('manager.edit_manager', manager_id=manager.id) }}" class="btn btn-warning btn-sm">Edit</a>
                                        <a href="{{ url_for('manager.delete_manager', manager_id=manager.id) }}" class="btn btn-danger btn-sm" onclick="return confirm('Are you sure you want to delete this manager?')">Delete</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                {% endif %}
                {% endfor %}
            </div>

            <style>
                .green-dot {
                    width: 10px;
                    height: 10px;
                    border-radius: 50%;
                    background-color: green;
                    display: inline-block;
                }

                .red-dot {
                    width: 10px;
                    height: 10px;
                    border-radius: 50%;
                    background-color: red;
                    display: inline-block;
                }
            </style>
        </div>
    </main>

{% include 'admin/admin_footer.html' %}
